{"version":3,"sources":["./src/app/modules/public/module/player/player.module.ts","./src/app/modules/shared-feature/components/batch-info/batch-info.component.ts","./src/app/modules/public/module/player/player-routing.module.ts"],"names":[],"mappings":"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","file":"module-player-player-module-ngfactory.js","sourcesContent":["import { PlayerRoutingModule } from './player-routing.module';\nimport { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { TelemetryModule } from '@sunbird/telemetry';\nimport { SharedModule } from '@sunbird/shared';\nimport { BadgingModule } from '@sunbird/badge';\nimport { CoreModule } from '@sunbird/core';\nimport { PlayerHelperModule } from '@sunbird/player-helper';\nimport { SuiModalModule } from 'ng2-semantic-ui-v9';\nimport { CommonConsumptionModule} from '@project-sunbird/common-consumption-v9';\nimport { SharedFeatureModule } from '@sunbird/shared-feature';\n\n@NgModule({\n    imports: [\n        CommonModule,\n        PlayerRoutingModule,\n        TelemetryModule,\n        SharedModule,\n        BadgingModule,\n        CoreModule,\n        PlayerHelperModule,\n        SuiModalModule,\n        CommonConsumptionModule,\n        SharedFeatureModule\n    ],\n    providers: [],\n    declarations: []\n})\nexport class PlayerModule { }\n","import { Component, OnInit, Output, EventEmitter, Input, OnDestroy } from '@angular/core';\nimport { ResourceService, ToasterService, ConfigService } from '@sunbird/shared';\nimport { PlayerService, LearnerService, UserService, CoursesService, GeneraliseLabelService } from '@sunbird/core';\nimport * as _ from 'lodash-es';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { takeUntil, mergeMap, tap, delay } from 'rxjs/operators';\nimport { Subject } from 'rxjs';\nimport dayjs from 'dayjs';\n\n@Component({\n  selector: 'app-batch-info',\n  templateUrl: './batch-info.component.html',\n  styleUrls: ['./batch-info.component.scss']\n})\nexport class BatchInfoComponent implements OnInit, OnDestroy {\n\n  @Input() enrolledBatchInfo: any;\n  @Output() modelClose = new EventEmitter;\n  @Output() routeChanged = new EventEmitter();\n  public userDetails = {};\n  public hasOngoingBatches = false;\n  public enrolledBatches: Array<any> = [];\n  public openForEnrollBatches: Array<any> = [];\n  public disableEnrollBtn = false;\n  public unsubscribe = new Subject<void>();\n  public enrollInteractEdata;\n  public resumeInteractEdata;\n\n  constructor(public resourceService: ResourceService, public playerService: PlayerService, public configService: ConfigService,\n    public learnerService: LearnerService, public userService: UserService, public toasterService: ToasterService,\n    public coursesService: CoursesService, public router: Router, public generaliseLabelService: GeneraliseLabelService,\n    public activatedRoute: ActivatedRoute) {\n      this.resumeInteractEdata = {\n        id: 'resume',\n        type: 'click',\n        pageid: 'batch-info'\n      };\n      this.enrollInteractEdata = {\n        id: 'enroll',\n        type: 'click',\n        pageid: 'batch-info'\n      };\n    }\n\n  ngOnInit() {\n    if (this.enrolledBatchInfo.onGoingBatchCount) {\n      this.hasOngoingBatches = true;\n      this.enrolledBatches = _.concat(this.enrolledBatchInfo.inviteOnlyBatch.ongoing, this.enrolledBatchInfo.openBatch.ongoing);\n    } else {\n      this.enrolledBatches = _.concat(this.enrolledBatchInfo.inviteOnlyBatch.expired, this.enrolledBatchInfo.openBatch.expired);\n      this.getAllOpenBatchForCourse().pipe(takeUntil(this.unsubscribe))\n      .subscribe(data => {\n        this.openForEnrollBatches = _.get(data, 'result.response.content') || [];\n        this.fetchUserDetails(_.map(this.openForEnrollBatches, batch => batch.createdBy));\n      });\n    }\n    this.fetchUserDetails(_.map(this.enrolledBatches, batch => batch.batch.createdBy));\n  }\n  private getAllOpenBatchForCourse() {\n    const option = {\n      url: this.configService.urlConFig.URLS.BATCH.GET_BATCHS,\n      data: {\n        request: {\n          filters: {\n            status: [ '1' ],\n            enrollmentType: 'open',\n            courseId: this.enrolledBatchInfo.courseId\n          },\n          offset: 0,\n          sort_by: { createdDate: 'desc' }\n        }\n      }\n    };\n    return this.learnerService.post(option);\n  }\n  public handleResumeEvent(event) {\n    this.routeChanged.emit(false);\n    event.mimeType = 'application/vnd.ekstep.content-collection'; // to route to course page\n    event.contentType = 'Course'; // route to course page\n    event.primaryCategory = 'Course';\n    this.playerService.playContent(event);\n  }\n  public handleEnrollmentEndDate(batchDetails) {\n    const enrollmentEndDate = dayjs(_.get(batchDetails, 'enrollmentEndDate')).format('YYYY-MM-DD');\n    const systemDate = dayjs();\n    const disableEnrollBtn = enrollmentEndDate ? dayjs(enrollmentEndDate).isBefore(systemDate) : false;\n    return disableEnrollBtn;\n  }\n  public handleStartDate(batchDetails) {\n    const batchStartDate = dayjs(_.get(batchDetails, 'startDate')).format('YYYY-MM-DD');\n    const systemDate = dayjs();\n    const isJoinNotEnabled = batchStartDate ? dayjs(batchStartDate).isAfter(systemDate) : false;\n    return isJoinNotEnabled;\n  }\n  public handleEnrollEvent(event) {\n    this.disableEnrollBtn = true;\n    const options = {\n      url: this.configService.urlConFig.URLS.COURSE.ENROLL_USER_COURSE,\n      data: {\n        request: {\n          courseId: event.courseId,\n          userId: this.userService.userid,\n          batchId: event.identifier\n        }\n      }\n    };\n    this.learnerService.post(options).pipe(\n      tap(data => {\n        this.toasterService.success(this.resourceService.messages.smsg.m0036);\n      }),\n      delay(2000), // wait for data to sync\n      mergeMap(data => this.coursesService.getEnrolledCourses()), // fetch enrolled course\n    ).subscribe(data => {\n      const textbook = _.get(this.activatedRoute, 'snapshot.queryParams.textbook');\n      const queryParams = textbook ? { textbook } : {};\n      this.router.navigate(['/learn/course', event.courseId, 'batch', event.identifier], { queryParams }).then(res => {\n        this.routeChanged.emit(true);\n      });\n    }, (err) => {\n      this.disableEnrollBtn = false;\n      this.toasterService.error(this.resourceService.messages.emsg.m0001);\n    });\n  }\n  private fetchUserDetails(userIds = []) {\n    if (!userIds.length) {\n      return;\n    }\n    const option = {\n      url: this.configService.urlConFig.URLS.ADMIN.USER_SEARCH,\n      data: {\n        request: {\n          filters: { identifier: _.compact(_.uniq(userIds)) }\n        }\n      }\n    };\n    this.learnerService.post(option).pipe(takeUntil(this.unsubscribe))\n    .subscribe(({result}) => _.forEach(_.get(result, 'response.content'), user => this.userDetails[user.identifier] = user));\n  }\n  ngOnDestroy() {\n    this.unsubscribe.next();\n    this.unsubscribe.complete();\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\nimport { ContentPlayerComponent, CollectionPlayerComponent } from '@sunbird/shared-feature';\nimport { PendingchangesGuard } from './../../services';\n\nconst routes: Routes = [\n    {\n        path: 'content/:contentId', component: ContentPlayerComponent, data: {\n            // routeReuse: {\n            //     reuse: true,\n            //     path: '/play/content'\n            //   },\n            menuBar: {\n                visible: false\n            },\n            telemetry: {\n                env: 'public', pageid: 'play-content', type: 'view', subtype: 'paginate'\n            }\n        }\n    },\n    {\n        path: 'collection/:collectionId', component: CollectionPlayerComponent, data: {\n            // routeReuse: {\n            //     reuse: true,\n            //     path: '/play/collection'\n            //   },\n\n            menuBar: {\n                visible: false\n            },\n            telemetry: {\n                env: 'public', pageid: 'play-collection', type: 'view', subtype: 'paginate'\n            }\n        }\n    },\n    {\n        path: 'questionset/:contentId', component: ContentPlayerComponent, canDeactivate: [PendingchangesGuard],\n        data: {\n\n            menuBar: {\n                visible: false\n            },\n            telemetry: {\n                env: 'public', pageid: 'play-questionset', type: 'view', subtype: 'paginate'\n            }\n        }\n    }\n];\n@NgModule({\n    imports: [RouterModule.forChild(routes)],\n    exports: [RouterModule]\n})\nexport class PlayerRoutingModule { }\n"],"sourceRoot":"webpack:///"}